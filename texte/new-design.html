<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Der Knochen-Schatzsucher - Lesekumpel</title>
    <style>
        /* --- GRUNDLAGEN & VARIABLEN (Mobile First) --- */
        :root {
            --bg-color: #fdfbf7; 
            --text-color: #2c2c2c;
            --accent-color: #2a9d8f;
            --highlight-color: #e9c46a;
            --syl-blue: #00509d; 
            --syl-red: #c1121f; 
            --trans-color: #7209b7; /* Farbe f√ºr englische W√∂rter */
            --font-main: 'Verdana', sans-serif;
            --font-dyslexic: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            --spacing-std: 1.6;
            --spacing-dyslexic: 2.0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: var(--spacing-std);
            margin: 0;
            padding-bottom: 80px; 
            transition: all 0.3s ease;
        }

        /* --- FORTSCHRITTSBALKEN --- */
        #progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: #ddd;
            z-index: 1000;
        }
        #progress-bar {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
        }

        /* --- CONTAINER --- */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header { text-align: center; margin-top: 20px; margin-bottom: 20px; }
        
        /* Titel Style Anpassung */
        h1#main-title {
            margin-bottom: 5px; /* Weniger Abstand zur Badge */
            line-height: 1.2;
        }

        .hero-image {
            width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .quality-badge {
            background-color: #fff;
            border: 2px solid var(--accent-color);
            border-radius: 20px;
            padding: 5px 15px;
            font-size: 0.9em;
            display: inline-block;
            margin-top: 5px;  /* Abstand nach oben zum Titel */
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* --- TOOLBAR --- */
        .toolbar {
            background: #fff;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            position: sticky;
            top: 10px;
            z-index: 900;
        }
        
        button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            touch-action: manipulation;
        }
        button:hover { opacity: 0.9; }
        button.active {
            background: #264653;
            border: 2px solid var(--highlight-color);
        }
        button#btn-summary.active {
            background: #e76f51; 
            border-color: #e76f51;
        }
        button#btn-lang.active {
            background: var(--trans-color);
        }

        /* --- DYSLEXIE & SILBEN --- */
        body.dyslexia-mode {
            font-family: var(--font-dyslexic);
            letter-spacing: 0.05em;
            word-spacing: 0.1em;
            line-height: var(--spacing-dyslexic);
        }

        .syl-blue { color: var(--syl-blue); }
        .syl-red { color: var(--syl-red); }
        
        .translated-word {
            color: var(--trans-color);
            font-style: italic;
            font-weight: bold;
        }
        
        /* --- LUPE --- */
        .magnifier-overlay {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            border: 3px solid var(--accent-color);
            padding: 20px;
            border-radius: 15px;
            font-size: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
            text-align: center;
            width: 85%;
        }
        .word-interactive {
            cursor: pointer;
            border-radius: 3px;
        }
        .word-interactive:hover {
            background-color: var(--highlight-color);
        }

        /* --- TEXT ANSICHTEN --- */
        .hidden { display: none; }
        
        .chunk-card {
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            font-size: 1.3rem;
            min-height: 150px;
            display: block; 
            line-height: 1.8;
        }

        .chunk-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        /* --- EXTRAS --- */
        .quiz-container {
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            border: 1px solid #ddd;
        }
        .quiz-option {
            display: block;
            margin: 8px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
        }
        .quiz-option:hover { background: #e0e0e0; }
        .correct { background: #a7c957 !important; }
        .wrong { background: #e76f51 !important; }

        .author-box {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #fff;
            padding: 15px;
            border-radius: 15px;
            margin-top: 30px;
        }
        .author-img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }

        .interaction-area {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 20px;
            background: #fff;
            border-radius: 15px;
        }
        
        .tags { margin-top: 20px; }
        .tag {
            background: #ddd;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-right: 5px;
            text-decoration: none;
            color: #333;
            display: inline-block;
            margin-bottom: 5px;
        }

        .whatsapp-float {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #25d366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            font-size: 30px;
            padding: 10px 15px;
            box-shadow: 2px 2px 3px #999;
            z-index: 100;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <div id="progress-container"><div id="progress-bar"></div></div>

    <div class="container">
        <header>
            <h1 id="main-title">DER KNOCHEN-SCHATZSUCHER</h1>
            <div class="quality-badge">‚≠ê 90% gef√§llt das (110 Leser)</div>
        </header>

        <img src="https://rala84.github.io/lesekumpel/bilder/der-knochenschatzsucher.png" alt="Hund gr√§bt im Garten nach Knochen" class="hero-image">

        <nav class="toolbar">
            <button onclick="toggleLanguage()" id="btn-lang">üá©üá™ Deutsch</button>
            <button onclick="toggleSummaryMode()" id="btn-summary">üìñ Einfach</button>
            <button onclick="toggleTTS()">üîä Vorlesen</button>
            <button onclick="toggleSyllables()" id="btn-syllables">üî° Silben: AUS</button>
            <button onclick="toggleDyslexia()">üëÅÔ∏è Schrift</button>
            <button onclick="changeFontSize(1)">A+</button>
            <button onclick="changeFontSize(-1)">A-</button>
            <button onclick="toggleViewMode()" id="view-toggle-btn">üß© H√§ppchen</button>
            <button onclick="toggleMagnifier()" id="magnifier-btn">üîç Lupe</button>
        </nav>

        <div id="magnifier-overlay" class="magnifier-overlay">
            <span id="magnifier-text">Wort</span>
            <div style="margin-top:15px;">
                <button onclick="speakMagnifiedWord()">üîä H√∂ren</button>
                <button onclick="closeMagnifier()" style="background:#e76f51;">Schlie√üen</button>
            </div>
        </div>

        <main>
            <div id="full-text-view" class="content-view"></div>

            <div id="chunk-view" class="content-view hidden">
                <div id="chunk-display" class="chunk-card"></div>
                <div class="chunk-controls">
                    <button onclick="prevChunk()">Zur√ºck</button>
                    <span id="chunk-counter">1 / 5</span>
                    <button onclick="nextChunk()">Weiter</button>
                </div>
            </div>

            <section class="quiz-container">
                <h2>‚ùì Lese-Quiz</h2>
                <div id="quiz-wrapper"></div>
            </section>

            <section class="author-box">
                <img src="https://github.com/RaLa84/lesekumpel/blob/main/Jonas-min-compressed.webp?raw=true" alt="Autor Jonas" class="author-img">
                <div>
                    <strong>Autor: Jonas</strong>
                    <p>Jonas ist immer auf Achse! Er erz√§hlt dir die besten Geschichten von seinen wilden Abenteuern drau√üen.</p>
                </div>
            </section>

            <section class="interaction-area">
                <div class="microsurvey">
                    <p>Wie war die Geschichte?</p>
                    <button onclick="alert('Danke!')">üëç</button>
                    <button onclick="alert('Danke!')">üëé</button>
                </div>
                <div class="comments">
                    <button onclick="toggleComments()">üí¨ Kommentare</button>
                </div>
            </section>

            <div id="comment-section" class="hidden" style="margin-top:20px;">
                <textarea style="width:100%; height:80px; padding:10px;" placeholder="Dein Kommentar..."></textarea>
                <button style="margin-top:5px;">Senden</button>
            </div>

            <div class="tags">
                <span class="tag">#Hund</span> <span class="tag">#Haustier</span> 
                <span class="tag">#Tierverhalten</span> <span class="tag">#Humor</span>
            </div>
        </main>
    </div>

    <a href="whatsapp://send?text=Lies dir diese Geschichte durch!" class="whatsapp-float">üì±</a>

    <script>
        const dictionary = {
            "Garten": "garden",
            "Gar-ten": "garden",
            "Langeweile": "boredom",
            "su-per-lang-wei-lig": "super boring",
            "superlangweilig": "super boring",
            "Sonne": "sun",
            "Son-ne": "sun",
            "Buddy": "Buddy",
            "Bud-dy": "Buddy",
            "Hund": "dog",
            "Knochen": "bone",
            "Kno-chen": "bone",
            "Markknochen": "marrow bone",
            "Mark-kno-chen": "marrow bone",
            "Schatz": "treasure",
            "Gras": "grass",
            "Nase": "nose",
            "Na-se": "nose",
            "Boden": "ground",
            "Bo-den": "ground",
            "Schwanz": "tail",
            "Loch": "hole",
            "buddeln": "dig",
            "bud-del-te": "dug",
            "verstecken": "hide",
            "ver-ste-cken": "hide",
            "Apfelbaum": "apple tree",
            "Ap-fel-baum": "apple tree",
            "Erde": "soil",
            "Er-de": "soil",
            "Pfoten": "paws",
            "Pfo-ten": "paws",
            "stolz": "proud",
            "Arch√§ologe": "archaeologist",
            "Ar-ch√§-o-lo-ge": "archaeologist",
            "Pyramide": "pyramid",
            "Py-ra-mi-de": "pyramid",
            "schn√ºffeln": "sniff",
            "schn√ºf-fel-te": "sniffed",
            "lachen": "laugh",
            "la-chen": "laugh",
            "Haustiere": "pets",
            "Haus-tie-re": "pets",
            "s√º√ü": "cute",
            "lieb": "love"
        };

        const storyRaw = `
Oh Mann, ich sa√ü neu-lich im Gar-ten und mir war su-per-lang-wei-lig. Die Son-ne schien, a-ber es gab ein-fach nichts Span-nen-des zu tun. Dann kam Bud-dy, un-ser Hund, um die E-cke ge-flitzt. Er hat-te ei-nen rie-si-gen Kno-chen im Maul, so ei-nen rich-tig di-cken Mark-kno-chen. Und er hat-te die-sen Blick drauf, wei√üt du? Die-sen Blick, der sagt: ‚ÄûDas ist MEIN Schatz und nie-mand kriegt ihn!‚Äú
<br><br>
Bud-dy trot-te-te durchs Gras. Sei-ne Na-se schn√ºf-fel-te am Bo-den. Der Schwanz wa-ckel-te wie wild. Er woll-te den Kno-chen ver-ste-cken. A-ber nicht ein-fach so, nein! Es muss-te der per-fek-te Ort sein. Er bud-del-te hier ein klei-nes Loch. Er schau-te sich um und schien zu den-ken: ‚ÄûNee, doch nicht gut ge-nug.‚Äú Dann scharr-te er ein St√ºck wei-ter. Er mach-te wie-der ein klei-nes Loch und guck-te mich an, als w√ºr-de er sa-gen: ‚ÄûGuck blo√ü nicht her!‚Äú Als ob ich ihn nicht se-hen w√ºr-de!
<br><br>
Nach ge-f√ºhlt tau-send Fehl-ver-su-chen (er hat min-des-tens f√ºnf L√∂-cher an-ge-fan-gen und dann wie-der zu-ge-sch√ºt-tet), fand er end-lich sei-nen aus-er-w√§hl-ten Platz un-ter dem Ap-fel-baum. Er leg-te den Kno-chen vor-sich-tig rein. Er stup-ste ihn mit der Na-se tie-fer und dann ging die Ar-beit los. Er schob Er-de dr√º-ber, im-mer wie-der, mit der Na-se und den Pfo-ten. Da-bei hat er so ei-ne erns-te Mie-ne ge-macht, als w√§-re er ein Ar-ch√§-o-lo-ge, der ge-ra-de ei-ne al-te Py-ra-mi-de ver-bud-delt.
<br><br>
Als er fer-tig war, stand er da. Er dreh-te sich noch ein paar Mal um den Hau-fen und schn√ºf-fel-te. Er war so stolz auf sein Werk! Und dann guck-te er mich wie-der an, als woll-te er sa-gen: ‚ÄûSiehst du? Nie-mand wei√ü, wo der Kno-chen ist!‚Äú Ich muss-te mir echt auf die Lip-pe bei-√üen, um nicht zu la-chen. Ich wuss-te na-t√ºr-lich ge-nau, wo er war. Ein-mal kurz hin-schau-en und zack, ge-fun-den! A-ber ich hab so ge-tan, als h√§t-te ich nichts mit-be-kom-men. Er soll doch den-ken, er ist der ge-ni-als-te Kno-chen-ver-ste-cker der Welt.
<br><br>
Kennst du das auch, wenn dei-ne Haus-tie-re manch-mal so bl√∂-de, a-ber gleich-zei-tig so s√º√ü sind, dass man sie ein-fach lieb ha-ben muss?
`;

        const summaryRaw = `
Ich sa√ü ge-lang-weilt im Gar-ten.<br>
Dann kam un-ser Hund Bud-dy mit ei-nem gro-√üen Kno-chen.<br>
Bud-dy woll-te den Kno-chen ver-ste-cken.<br>
Er grub vie-le L√∂-cher. Am En-de ver-grub er ihn un-ter dem Ap-fel-baum.<br>
Er war sehr stolz. Ich wuss-te, wo der Kno-chen liegt.<br>
A-ber ich tat so, als h√§t-te ich nichts ge-se-hen.
`;

        const quizData = [
            { q: "Was hatte Buddy im Maul?", a: ["Einen Stock", "Eine Spielzeugmaus", "Einen riesigen Knochen"], correct: 2 },
            { q: "Wo hat Buddy den Knochen versteckt?", a: ["Unter dem Apfelbaum", "Im Blumenbeet", "Hinter der H√ºtte"], correct: 0 },
            { q: "Wie viele L√∂cher hat er angefangen?", a: ["Nur eins", "Mindestens f√ºnf", "Hundert"], correct: 1 }
        ];

        let state = {
            fontSize: 100,
            isMagnifier: false,
            isSyllables: false, 
            isSummaryMode: false,
            isEnglish: false, 
            chunkIndex: 0,
            chunks: []
        };

        function formatText(rawText, showSyllables) {
            let cleanRaw = rawText.replace(/\n/g, " "); 
            let paragraphs = cleanRaw.split('<br>');
            
            let formattedParagraphs = paragraphs.map(para => {
                if(para.trim() === "") return "";
                const words = para.split(' ');
                
                const processedWords = words.map(word => {
                    const cleanWord = word.replace(/-/g, "").replace(/[.,!?:;‚Äû‚Äú()]/g, ""); 
                    let displayHTML = "";
                    let speakText = cleanWord;
                    let isTranslated = false;

                    if (state.isEnglish) {
                        if (dictionary[cleanWord]) {
                            displayHTML = dictionary[cleanWord];
                            speakText = dictionary[cleanWord];
                            isTranslated = true;
                        } else if (dictionary[word.replace(/[.,!?:;‚Äû‚Äú()]/g, "")]) {
                            displayHTML = dictionary[word.replace(/[.,!?:;‚Äû‚Äú()]/g, "")];
                            speakText = displayHTML;
                            isTranslated = true;
                        }
                    }

                    if (isTranslated) {
                        displayHTML = `<span class="translated-word">${displayHTML}</span>`;
                    } else {
                        if (!showSyllables) {
                            displayHTML = word.replace(/-/g, "");
                        } else {
                            const parts = word.split('-');
                            if (parts.length === 1) {
                                displayHTML = `<span class="syl-blue">${parts[0]}</span>`;
                            } else {
                                displayHTML = parts.map((part, idx) => {
                                    const colorClass = (idx % 2 === 0) ? 'syl-blue' : 'syl-red';
                                    return `<span class="${colorClass}">${part}</span>`;
                                }).join('-'); 
                            }
                        }
                    }

                    if(word.trim() === "") return "";
                    const langAttr = isTranslated ? 'en-US' : 'de-DE';
                    return `<span class="word-interactive" onclick="handleWordClick(this, '${speakText}', '${langAttr}')">${displayHTML}</span>`;
                });
                return processedWords.join(' ');
            });
            return formattedParagraphs.join('<br>');
        }

        function renderAll() {
            const btnSyl = document.getElementById('btn-syllables');
            btnSyl.innerText = state.isSyllables ? "üî° Silben: AN" : "üî° Silben: AUS";
            if(state.isSyllables) btnSyl.classList.add('active'); else btnSyl.classList.remove('active');

            const btnSum = document.getElementById('btn-summary');
            let currentRawText = "";
            
            if (state.isSummaryMode) {
                btnSum.innerText = "üìñ Original";
                btnSum.classList.add('active');
                currentRawText = summaryRaw;
            } else {
                btnSum.innerText = "üìñ Einfach";
                btnSum.classList.remove('active');
                currentRawText = storyRaw;
            }

            const btnLang = document.getElementById('btn-lang');
            if(state.isEnglish) {
                btnLang.classList.add('active');
                btnLang.innerText = "üá¨üáß English";
            } else {
                btnLang.classList.remove('active');
                btnLang.innerText = "üá©üá™ Deutsch";
            }

            const fullHtml = formatText(currentRawText, state.isSyllables);
            document.getElementById('full-text-view').innerHTML = fullHtml;
            
            state.chunks = currentRawText.split('<br><br>').map(c => formatText(c, state.isSyllables));
            if (state.chunkIndex >= state.chunks.length) state.chunkIndex = 0;
            updateChunkDisplay();
        }

        function updateChunkDisplay() {
            if(state.chunks.length > 0) {
                document.getElementById('chunk-display').innerHTML = state.chunks[state.chunkIndex];
                document.getElementById('chunk-counter').innerText = (state.chunkIndex + 1) + " / " + state.chunks.length;
            }
        }

        function toggleLanguage() {
            state.isEnglish = !state.isEnglish;
            renderAll();
        }

        function toggleSummaryMode() {
            state.isSummaryMode = !state.isSummaryMode;
            state.chunkIndex = 0;
            renderAll();
        }

        function toggleSyllables() {
            state.isSyllables = !state.isSyllables;
            renderAll();
        }

        function toggleTTS() {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            } else {
                let textToRead = document.getElementById('full-text-view').innerText;
                if(document.getElementById('full-text-view').classList.contains('hidden')) {
                     textToRead = document.getElementById('chunk-display').innerText;
                }
                
                let u = new SpeechSynthesisUtterance(textToRead);
                u.lang = "de-DE";
                u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        }

        function toggleDyslexia() {
            document.body.classList.toggle('dyslexia-mode');
        }

        function changeFontSize(dir) {
            state.fontSize += (dir * 10);
            if(state.fontSize < 80) state.fontSize = 80;
            if(state.fontSize > 200) state.fontSize = 200;
            document.body.style.fontSize = state.fontSize + "%";
        }

        function toggleViewMode() {
            const fullView = document.getElementById('full-text-view');
            const chunkView = document.getElementById('chunk-view');
            const btn = document.getElementById('view-toggle-btn');
            
            if (fullView.classList.contains('hidden')) {
                fullView.classList.remove('hidden');
                chunkView.classList.add('hidden');
                btn.innerText = "üß© H√§ppchen";
            } else {
                fullView.classList.add('hidden');
                chunkView.classList.remove('hidden');
                btn.innerText = "üìú Gesamttext";
                state.chunkIndex = 0;
                updateChunkDisplay();
            }
        }

        function nextChunk() {
            if (state.chunkIndex < state.chunks.length - 1) {
                state.chunkIndex++;
                updateChunkDisplay();
            }
        }

        function prevChunk() {
            if (state.chunkIndex > 0) {
                state.chunkIndex--;
                updateChunkDisplay();
            }
        }

        function toggleMagnifier() {
            state.isMagnifier = !state.isMagnifier;
            const btn = document.getElementById('magnifier-btn');
            if(state.isMagnifier) btn.classList.add('active');
            else {
                btn.classList.remove('active');
                closeMagnifier();
            }
        }

        function handleWordClick(el, speakText, langCode) {
            if(!state.isMagnifier) return;
            const overlay = document.getElementById('magnifier-overlay');
            const magText = document.getElementById('magnifier-text');
            
            magText.innerText = speakText; 
            magText.setAttribute('data-speak', speakText);
            magText.setAttribute('data-lang', langCode);
            
            overlay.style.display = 'block';
        }

        function speakMagnifiedWord() {
            const word = document.getElementById('magnifier-text').getAttribute('data-speak');
            const lang = document.getElementById('magnifier-text').getAttribute('data-lang');
            
            let u = new SpeechSynthesisUtterance(word);
            u.lang = lang || "de-DE"; 
            window.speechSynthesis.speak(u);
        }

        function closeMagnifier() {
            document.getElementById('magnifier-overlay').style.display = 'none';
        }

        function toggleComments() {
            document.getElementById('comment-section').classList.toggle('hidden');
        }

        function loadQuiz() {
            const wrapper = document.getElementById('quiz-wrapper');
            quizData.forEach((item, index) => {
                let html = `<div style="margin-bottom:20px;"><p><strong>${index + 1}. ${item.q}</strong></p>`;
                item.a.forEach((ans, aIndex) => {
                    html += `<span class="quiz-option" onclick="checkAnswer(this, ${index}, ${aIndex})">${ans}</span>`;
                });
                html += `</div>`;
                wrapper.innerHTML += html;
            });
        }

        function checkAnswer(el, qIndex, aIndex) {
            const parent = el.parentNode;
            const options = parent.getElementsByClassName('quiz-option');
            for(let opt of options) opt.style.background = '#f0f0f0'; 
            if (aIndex === quizData[qIndex].correct) {
                el.classList.add('correct');
                el.innerText += " ‚úÖ";
            } else {
                el.classList.add('wrong');
                el.innerText += " ‚ùå";
            }
        }

        window.onscroll = function() {
            let winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            let height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            let scrolled = (winScroll / height) * 100;
            document.getElementById("progress-bar").style.width = scrolled + "%";
        };

        window.onload = function() {
            loadQuiz();
            renderAll();
        };
    </script>
</body>
</html>
