<!DOCTYPE html>
<html lang="de" data-syllmode="off">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deine Geschichte</title>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&family=Comic+Sans+MS&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg:#f0f8ff; --fg:#16202a; --brand:#ff6b6b; --border:#ffcc00; --focus:#ffd54a; --card:#ffffff;
    }

    body {
      margin:0; padding:20px; background:var(--bg); color:var(--fg);
      font-family: 'Atkinson Hyperlegible', 'Comic Sans MS', sans-serif;
      display: flex; flex-direction: column; align-items: center;
    }

    .container {
      max-width: 800px; width: 100%; background:var(--card); padding: 40px;
      border-radius: 20px; border: 5px solid var(--border);
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
      position: relative;
    }

    /* --- TOOLBAR (Jetzt oben) --- */
    .tools {
      display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
      background: #fff9e6; padding: 15px; border-radius: 15px;
      margin-bottom: 30px; border: 2px dashed var(--border);
    }
    button {
      background: white; border: 2px solid var(--border); border-radius: 10px;
      padding: 10px 15px; cursor: pointer; font-weight: 700; color: #555;
      font-family: inherit; transition: all 0.1s;
    }
    button:hover { transform: translateY(-2px); border-color: var(--brand); color: var(--brand); }
    button[aria-pressed="true"] { background: var(--brand); color: white; border-color: var(--brand); }

    /* --- INHALT --- */
    h1 { color: var(--brand); text-align: center; font-size: 2.5em; text-transform: uppercase; margin-bottom: 20px; }
    
    #story-content { font-size: 1.4em; line-height: 1.8; color: #444; transition: font-size 0.2s; }
    
    p { margin-bottom: 1.5rem; }

    /* --- SILBEN & WORTE --- */
    .word { position:relative; display: inline-block; margin-right: 0.25em; cursor: default; }
    .syll { padding-bottom:.05em; border-bottom:1px dotted transparent; transition: color 0.2s; }

    /* Modus: Farben */
    [data-syllmode="color"] .word .syll:nth-child(odd){ color: #007bff; }
    [data-syllmode="color"] .word .syll:nth-child(even){ color: #d32f2f; }
    
    /* --- BILD --- */
    .story-image {
      display: block; margin: 0 auto 30px auto; width: 100%; max-width: 400px;
      border-radius: 15px; object-fit: contain;
    }

    /* --- FOOTER (Wiederhergestellt) --- */
    .footer { 
        margin-top: 60px; padding-top: 30px; border-top: 3px dashed var(--border); 
        text-align: center; font-size: 1em; color: #888; 
    }
    .footer a { 
        color: #888; text-decoration: none; font-weight: bold; margin: 0 10px; transition: color 0.2s; 
    }
    .footer a:hover { color: var(--brand); }
    .separator { color: var(--border); font-weight: bold; }

    /* --- LUPE --- */
    .lens {
      position: fixed; z-index: 9999; pointer-events: none;
      padding: .25rem .75rem; background: white;
      border: 3px solid var(--brand); border-radius: .8rem;
      box-shadow: 0 8px 18px rgba(0,0,0,.15);
      font-weight: 700; font-size: 1.8rem; color: #333;
      transform: translate(-50%, -130%); display: none; white-space: nowrap;
    }
    .lens[data-show="true"] { display: block; }
  </style>
</head>
<body>

  <div class="lens" id="lens" data-show="false"><span id="lensText"></span></div>

  <div class="container">
    
    <div class="tools">
      <button id="btnRead">üîä Vorlesen</button>
      <button id="btnFocus" aria-pressed="false">üîç Lupe</button>
      
      <div style="border-left: 2px solid #ddd; padding-left:10px; display:flex; gap:5px;">
        <button id="syllOff" aria-pressed="true">Zusammen</button>
        <button id="syllColor">üî¥üîµ Silben</button>
      </div>

      <div style="border-left: 2px solid #ddd; padding-left:10px; display:flex; gap:5px;">
        <button id="btnSmaller">A-</button>
        <button id="btnBigger">A+</button>
      </div>
    </div>

    <div id="story-content">
       <h1>Das fliegende Riesen-Monster: Antonov!</h1><img src="../bilder/das-fliegende-riesenmonster-antonov.png" onerror="this.onerror=null;this.src='https://rala84.github.io/lesekumpel/bilder/lesekumpel_logo.png';" class="story-image" alt="Bild">

<p>Hast du jemals ein Flugzeug gesehen und gedacht: "Wow, ist das GROSS!"? Dann halt dich fest, denn das ist noch GAR NICHTS gegen die <strong>Antonov-Flugzeuge</strong>! Stell dir vor, ein Flugzeug ist so riesig, dass es locker <strong>sieben Schulbusse</strong> hintereinander in seinem Bauch verstauen k√∂nnte. Echt jetzt?! Ja, wirklich!</p>

<p>Wir reden hier √ºber die Antonov An-225, liebevoll auch "Mriya" genannt, was so viel wie "Traum" bedeutet. Und es ist wirklich ein Traum von einem Flieger! Es ist das <strong>gr√∂√üte Transportflugzeug der Welt</strong> ‚Äì ein echter Koloss, der durch die Wolken schwebt.</p>

<p>Dieser fliegende Gigant ist ein absolutes Muskelpaket. Er kann bis zu 250 Tonnen transportieren! Das ist so viel wie <strong>zwei ganze Blauwale</strong> oder eine Herde von 50 ausgewachsenen Elefanten! Stell dir vor, du m√ºsstest diese Tiere in ein Flugzeug packen! Deswegen nimmt die Antonov auch nicht nur normale Koffer mit. Nein, dieses Flugzeug hat schon Windradfl√ºgel, riesige Generatoren oder sogar ganze Lokomotiven durch die Luft <strong>WUSCH!</strong> gebracht. Einfach unglaublich!</p>

<p>Und damit so ein Schwergewicht √ºberhaupt abheben kann, braucht es ordentlich viele Beine: sage und schreibe <strong>32 R√§der</strong>! Wenn dieses Monster dann auf der Startbahn entlangrollt und die sechs riesigen Triebwerke aufheulen ‚Äì <strong>BRRRRUMM!</strong> ‚Äì dann wei√üt du, dass da was ganz Besonderes in die Luft geht. Was w√ºrdest du als Erstes in so ein Riesen-Flugzeug packen, wenn du Pilot w√§rst?</p>
    </div>

    <div class="footer">
        <p>Erstellt von deinem KI-Lesekumpel ü§ñ</p>
        <div style="margin-top: 10px;">
            <a href="https://rala84.app.n8n.cloud/form/30d75a75-54fd-42fd-bea6-ab24799ca565">‚ú® Neue Geschichte</a>
            <span class="separator">|</span>
            <a href="../index.html">üìö Zur Bibliothek</a>
        </div>
    </div>

  </div>

  <script>
    // --- SILBEN-LOGIK ---
    function getSyllables(word) {
        if (word.length < 3) return [word];
        let w = word;
        w = w.replace(/(sch|ch|ck|ph|th|qu|st|sp)/gi, '¬ß$&¬ß');
        w = w.replace(/([aeiouy√§√∂√º])([^aeiouy√§√∂√º¬ß|])([aeiouy√§√∂√º])/gi, '$1|$2$3');
        w = w.replace(/([aeiouy√§√∂√º])([^aeiouy√§√∂√º¬ß|])([^aeiouy√§√∂√º¬ß|])([aeiouy√§√∂√º])/gi, '$1$2|$3$4');
        w = w.replace(/¬ß/g, '');
        return w.split('|');
    }

    // --- DOM UMBAU ---
    function processNode(node) {
        if (node.nodeType === 3) {
            const text = node.nodeValue;
            if (!text.trim()) return;

            const wrapper = document.createElement('span');
            const parts = text.split(/([ \t\n\r,.!?;:()"]+)/);
            
            parts.forEach(part => {
                if (/[a-zA-Z√§√∂√º√Ñ√ñ√ú√ü]/.test(part)) {
                    const wordSpan = document.createElement('span');
                    wordSpan.className = 'word';
                    const syllables = getSyllables(part);
                    syllables.forEach(syl => {
                        const sSpan = document.createElement('span');
                        sSpan.className = 'syll';
                        sSpan.innerText = syl;
                        wordSpan.appendChild(sSpan);
                    });
                    wrapper.appendChild(wordSpan);
                } else {
                    wrapper.appendChild(document.createTextNode(part));
                }
            });
            node.parentNode.replaceChild(wrapper, node);
        } else if (node.nodeType === 1) {
            // Tools, Scripts etc. ignorieren
            if (['SCRIPT','STYLE','BUTTON','IMG'].includes(node.tagName)) return;
            if (node.classList.contains('tools') || node.classList.contains('footer')) return;
            Array.from(node.childNodes).forEach(processNode);
        }
    }

    // --- HAUPT PROGRAMM ---
    document.addEventListener("DOMContentLoaded", () => {
      const contentRoot = document.getElementById('story-content');
      processNode(contentRoot);
      console.log("Lesekumpel: Text wurde verarbeitet.");

      const root = document.documentElement;
      
      // Buttons Logik
      document.getElementById('syllOff').onclick = () => setSyllMode('off');
      document.getElementById('syllColor').onclick = () => setSyllMode('color');

      function setSyllMode(mode) {
         root.setAttribute('data-syllmode', mode);
         document.getElementById('syllOff').setAttribute('aria-pressed', mode === 'off');
         document.getElementById('syllColor').setAttribute('aria-pressed', mode === 'color');
      }

      // Schriftgr√∂√üe
      let currentSize = 1.4;
      document.getElementById('btnBigger').onclick = () => {
         if (currentSize < 3.0) { currentSize += 0.2; contentRoot.style.fontSize = currentSize + "em"; }
      };
      document.getElementById('btnSmaller').onclick = () => {
         if (currentSize > 0.8) { currentSize -= 0.2; contentRoot.style.fontSize = currentSize + "em"; }
      };

      // Lupe
      const btnFocus = document.getElementById('btnFocus');
      const lens = document.getElementById('lens');
      const lensText = document.getElementById('lensText');
      let lensActive = false;

      btnFocus.onclick = () => {
          lensActive = !lensActive;
          btnFocus.setAttribute('aria-pressed', lensActive);
          if(!lensActive) lens.dataset.show = "false";
      };

      document.addEventListener('mousemove', (e) => {
          if (!lensActive) return;
          const target = e.target.closest('.word');
          if (target) {
              lens.dataset.show = "true";
              lensText.innerText = target.innerText;
              lens.style.left = e.clientX + 'px';
              lens.style.top = e.clientY + 'px';
          } else {
              lens.dataset.show = "false";
          }
      });

      // Vorlesen
      const btnRead = document.getElementById('btnRead');
      let isSpeaking = false;

      btnRead.onclick = () => {
          if(isSpeaking) {
              window.speechSynthesis.cancel();
              isSpeaking = false;
              btnRead.innerText = "üîä Vorlesen";
          } else {
              const text = document.body.innerText;
              const utt = new SpeechSynthesisUtterance(text);
              utt.lang = 'de-DE';
              utt.rate = 0.9;
              utt.onend = () => { isSpeaking = false; btnRead.innerText = "üîä Vorlesen"; };
              window.speechSynthesis.speak(utt);
              isSpeaking = true;
              btnRead.innerText = "‚èπ Stopp";
          }
      };
    });
  </script>
</body>
</html>