<!DOCTYPE html>
<html lang="de" data-syllmode="off">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deine Geschichte</title>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&family=Comic+Sans+MS&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg:#f0f8ff; --fg:#16202a; --brand:#ff6b6b; --border:#ffcc00; --focus:#ffd54a; --card:#ffffff;
    }

    body {
      margin:0; padding:20px; background:var(--bg); color:var(--fg);
      font-family: 'Atkinson Hyperlegible', 'Comic Sans MS', sans-serif;
      display: flex; flex-direction: column; align-items: center;
    }

    .container {
      max-width: 800px; width: 100%; background:var(--card); padding: 40px;
      border-radius: 20px; border: 5px solid var(--border);
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }

    /* TOOLBAR */
    .tools {
      display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
      background: #fff9e6; padding: 15px; border-radius: 15px;
      margin-bottom: 30px; border: 2px dashed var(--border);
    }
    button {
      background: white; border: 2px solid var(--border); border-radius: 10px;
      padding: 10px 15px; cursor: pointer; font-weight: 700; color: #555;
      font-family: inherit; transition: all 0.1s;
    }
    button:hover { transform: translateY(-2px); border-color: var(--brand); color: var(--brand); }
    button[aria-pressed="true"] { background: var(--brand); color: white; border-color: var(--brand); }

    /* TEXT */
    h1 { color: var(--brand); text-align: center; font-size: 2.5em; text-transform: uppercase; margin-bottom: 20px; }
    #story-content { font-size: 1.4em; line-height: 1.8; color: #444; }
    p { margin-bottom: 1.5rem; }

    /* SILBEN & WORTE */
    .word { position:relative; display: inline-block; margin-right: 0.25em; cursor: default; }
    .syll { padding-bottom:.05em; border-bottom:1px dotted transparent; transition: color 0.2s; }

    /* MODUS: FARBEN */
    [data-syllmode="color"] .word .syll:nth-child(odd){ color: #007bff; }
    [data-syllmode="color"] .word .syll:nth-child(even){ color: #d32f2f; }
    
    /* MODUS: TRENNEN */
    [data-syllmode="hyphen"] .word .syll + .syll::before {
      content:"-"; position:relative; color:currentColor; opacity:.6;
    }

    /* BILD */
    .story-image {
      display: block; margin: 0 auto 30px auto; width: 100%; max-width: 400px;
      border-radius: 15px; object-fit: contain;
    }

    /* LUPE (LENS) */
    .lens {
      position: fixed; z-index: 9999; pointer-events: none;
      padding: .25rem .75rem; background: white;
      border: 3px solid var(--brand); border-radius: .8rem;
      box-shadow: 0 8px 18px rgba(0,0,0,.15);
      font-weight: 700; font-size: 1.8rem; color: #333;
      transform: translate(-50%, -130%); display: none; white-space: nowrap;
    }
    .lens[data-show="true"] { display: block; }
  </style>
</head>
<body>

  <div class="lens" id="lens" data-show="false"><span id="lensText"></span></div>

  <div class="container">
    
    <div id="full-content">
       
<h1>Das warme Geheimnis im Br√∂tchenbett</h1><img src="../bilder/das-warme-geheimnis-im-broetchenbett.png" onerror="this.onerror=null;this.src='https://rala84.github.io/lesekumpel/bilder/lesekumpel_logo.png';" class="story-image" alt="Bild">

Stell dir vor, du h√§ltst etwas Warmes in deinen H√§nden. Es riecht so verlockend ‚Äì nach etwas Herzhaftem, aber auch ganz leicht nach weichem Brot. Ein runder Br√∂tchendeckel liegt da, so sanft wie eine frisch gebackene Wolke, und darauf tanzen winzige Sesamk√∂rner wie kleine, goldene Sternchen.

Darunter verbirgt sich eine Welt: saftiges, warmes Fleisch, und dar√ºber schmilzt K√§se wie eine goldene Decke. Ein knackiges Salatblatt lugt hervor, frisch und gr√ºn wie ein Fr√ºhlingsmorgen. Wenn du ganz vorsichtig hineinbei√üt... sp√ºrst du, wie alles zusammenkommt? Die weiche Br√∂tchenwolke, das w√ºrzige Herz, das frische Gr√ºn. Ein kleiner Augenblick Gl√ºck, der auf der Zunge zergeht.
    </div>

    <div class="tools">
      <button id="btnRead">üîä Vorlesen</button>
      <button id="btnFocus" aria-pressed="false">üîç Lupe</button>
      <div style="border-left: 2px solid #ddd; padding-left:10px; display:flex; gap:5px;">
        <button id="syllOff" aria-pressed="true">Normal</button>
        <button id="syllColor">üî¥üîµ Farben</button>
        <button id="syllHyphen">A-B Trennen</button>
      </div>
    </div>

  </div>

  <script>
    // --- SILBEN-LOGIK (Verbessert) ---
    function getSyllables(word) {
        if (word.length < 3) return [word];
        let w = word;
        // 1. Cluster sch√ºtzen (Dinge die zusammenbleiben m√ºssen)
        w = w.replace(/(sch|ch|ck|ph|th|qu|st|sp)/gi, '¬ß$&¬ß');
        
        // 2. Trenn-Regel: Vokal - Konsonant - Vokal (V-CV) -> o-fen
        // (Wir suchen: Vokal, dann KEIN Vokal/Trenner, dann Vokal)
        w = w.replace(/([aeiouy√§√∂√º])([^aeiouy√§√∂√º¬ß|])([aeiouy√§√∂√º])/gi, '$1|$2$3');
        
        // 3. Trenn-Regel: Vokal - Konsonant - Konsonant - Vokal (VC-CV) -> Was-ser
        w = w.replace(/([aeiouy√§√∂√º])([^aeiouy√§√∂√º¬ß|])([^aeiouy√§√∂√º¬ß|])([aeiouy√§√∂√º])/gi, '$1$2|$3$4');

        // Schutz entfernen
        w = w.replace(/¬ß/g, '');
        return w.split('|');
    }

    // --- DOM UMBAU ---
    // Diese Funktion sucht JEDEN Text und verpackt ihn
    function processNode(node) {
        if (node.nodeType === 3) { // Text Node
            const text = node.nodeValue;
            if (!text.trim()) return; // Leere ignorieren

            const wrapper = document.createElement('span');
            // Wir splitten an allem was kein Buchstabe ist
            const parts = text.split(/([ \t\n\r,.!?;:()"]+)/);
            
            parts.forEach(part => {
                if (/[a-zA-Z√§√∂√º√Ñ√ñ√ú√ü]/.test(part)) {
                    // WORT GEFUNDEN -> Verpacken
                    const wordSpan = document.createElement('span');
                    wordSpan.className = 'word'; // Wichtig f√ºr CSS!
                    
                    const syllables = getSyllables(part);
                    syllables.forEach(syl => {
                        const sSpan = document.createElement('span');
                        sSpan.className = 'syll';
                        sSpan.innerText = syl;
                        wordSpan.appendChild(sSpan);
                    });
                    wrapper.appendChild(wordSpan);
                } else {
                    // ZEICHEN -> Einfach anh√§ngen
                    wrapper.appendChild(document.createTextNode(part));
                }
            });
            
            // Ersetzen des alten Text-Knotens durch unsere Struktur
            node.parentNode.replaceChild(wrapper, node);
        } else if (node.nodeType === 1) { // Element Node (z.B. <p>)
            // Nicht in script/style/toolbar gehen
            if (['SCRIPT','STYLE','BUTTON','IMG'].includes(node.tagName)) return;
            if (node.classList.contains('tools')) return;

            // Rekursiv tiefer gehen
            Array.from(node.childNodes).forEach(processNode);
        }
    }

    // --- HAUPT PROGRAMM ---
    document.addEventListener("DOMContentLoaded", () => {
      // 1. Text umwandeln
      const contentRoot = document.getElementById('full-content');
      // Wir suchen speziell nach Abs√§tzen oder √úberschriften, um nicht alles zu zerst√∂ren
      // Aber zur Sicherheit scannen wir den Container:
      processNode(contentRoot);

      console.log("Lesekumpel: Text wurde verarbeitet.");

      // 2. Buttons verbinden
      const root = document.documentElement;
      
      // Silben Modus
      document.getElementById('syllOff').onclick = () => setSyllMode('off');
      document.getElementById('syllColor').onclick = () => setSyllMode('color');
      document.getElementById('syllHyphen').onclick = () => setSyllMode('hyphen');

      function setSyllMode(mode) {
         root.setAttribute('data-syllmode', mode);
         document.getElementById('syllOff').setAttribute('aria-pressed', mode === 'off');
         document.getElementById('syllColor').setAttribute('aria-pressed', mode === 'color');
         document.getElementById('syllHyphen').setAttribute('aria-pressed', mode === 'hyphen');
      }

      // 3. Lupe
      const btnFocus = document.getElementById('btnFocus');
      const lens = document.getElementById('lens');
      const lensText = document.getElementById('lensText');
      let lensActive = false;

      btnFocus.onclick = () => {
          lensActive = !lensActive;
          btnFocus.setAttribute('aria-pressed', lensActive);
          if(!lensActive) lens.dataset.show = "false";
      };

      document.addEventListener('mousemove', (e) => {
          if (!lensActive) return;
          const target = e.target.closest('.word');
          
          if (target) {
              lens.dataset.show = "true";
              lensText.innerText = target.innerText;
              lens.style.left = e.clientX + 'px';
              lens.style.top = e.clientY + 'px';
          } else {
              lens.dataset.show = "false";
          }
      });

      // 4. Vorlesen
      const btnRead = document.getElementById('btnRead');
      let isSpeaking = false;

      btnRead.onclick = () => {
          if(isSpeaking) {
              window.speechSynthesis.cancel();
              isSpeaking = false;
              btnRead.innerText = "üîä Vorlesen";
          } else {
              const text = document.body.innerText;
              const utt = new SpeechSynthesisUtterance(text);
              utt.lang = 'de-DE';
              utt.rate = 0.9;
              utt.onend = () => { isSpeaking = false; btnRead.innerText = "üîä Vorlesen"; };
              window.speechSynthesis.speak(utt);
              isSpeaking = true;
              btnRead.innerText = "‚èπ Stopp";
          }
      };

    });
  </script>
</body>
</html>